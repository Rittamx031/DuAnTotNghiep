<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" layout:decorate="~{user/layout_user}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Fashi Template">
    <meta name="keywords" content="Fashi, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Khăn choàng</title>


</head>

<body>
<section layout:fragment="content">
    <div class="breacrumb-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-text product-more">
                        <a href="/home"><i class="fa fa-home"></i> Trang chủ</a>
                        <a href="/products">Giỏ hàng</a>
                        <span>Thanh toán</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb Section Begin -->

    <!-- Shopping Cart Section Begin -->
    <section class="checkout-section spad pt-4">
        <div class="container">
            <form action="/checkout" method="post" id="checkout" class="checkout-form" onsubmit="return checkout()">
                <div class="row">
                    <div class="col-12">
                        <div class="row">
                            <div type="flex" class="ant-row ant-row-space-between box-row"
                                 style="margin-top: 12px;">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="tenKhachHang" class="form-label"><b>Tên
                                            Khách Hàng</b></label>
                                        <input type="text" class="form-control" placeholder="Tên khách hàng"
                                               th:value="${session.authenuser.getCustomer().name}" id="tenKhachHang">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="soDienThoai" class="form-label"><b>Số
                                            Điện Thoại</b></label>
                                        <input type="text" class="form-control" placeholder="Số điện thoại"
                                               th:value="${session.authenuser.getCustomer().phone}" id="soDienThoai">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="email" class="form-label"><b>Email</b></label>
                                        <input type="text" class="form-control" placeholder="Email"
                                               th:value="${session.authenuser.email}" id="email">
                                    </div>
                                    <!-- Địa chỉ -->
                                    <div class="col-md-6">
                                        <div class="row align-items-start">
                                            <div class="col">
                                                <label class="form-label"><b>Thành phố</b></label>
                                                <select class="form-control" id="Provinces" onchange="getDistricts()">
                                                    <option selected="">Chọn Thành Phố
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col">
                                                <label class="form-label"><b>Huyện</b></label>
                                                <select class="form-control" id="Districts" th:name="city"
                                                        onchange="getWards()">
                                                    <option selected="">Chọn Huyện</option>
                                                </select>
                                            </div>
                                            <div class="col">
                                                <label class="form-label"><b>Xã</b></label>
                                                <select class="form-control" th:name="country"
                                                        onchange="setFullAdress()" id="Wards">
                                                    <option selected="">Chọn Xã</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="FullAddress" th:name="fulladdress">
                                    <div class="col">
                                        <label class="form-label"><b>Địa
                                            Chỉ Cụ Thể</b></label>
                                        <input type="text" class="form-control" id="address"
                                               placeholder="Địa chỉ cụ thể">
                                    </div>
                                    <div class="col">
                                        <label class="form-label"> <b>Phương thức vận chuyển</b></label>
                                        <select class="form-control" id="shipService" onchange="updateTongTien()">
                                            <option selected="">Phương thức vận chuyển</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="place-order">
                            <h4>Đơn hàng của bạn</h4>
                            <div class="order-total">
                                <ul class="order-table">
                                    <li>Sản phẩm <span>Tổng tiền</span></li>
                                    <div th:each="cartDetail, loop : ${cartDetails}">
                                        <li class="fw-normal d-flex align-items-center justify-content-between">
                                            <div th:text="${cartDetail.quantity + ' x ' + cartDetail.productDetail.name}"></div>
                                            <span th:text="${#strings.replace(#numbers.formatDecimal(cartDetail.productDetail.price * cartDetail.quantity, 0, 'COMMA', 2, 'POINT'), '.00', '')} + ' VNĐ'"></span>
                                        </li>
                                    </div>
                                </ul>
                                <div class="order-btn">
                                    <button type="submit" class="site-btn place-btn">Đặt hàng</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        const token = "234a71c7-7b2c-11ee-af43-6ead57e9219a";
        const shop_id = 4676018;
        const districtform = 3440; // quận nam từ liêm
        const districtto = 3308; // huyện trực ninh
        const WardCodeninhcuong = "800083";
        const provinceSelect = document.getElementById("Provinces");
        const districtSelect = document.getElementById("Districts");
        const wardSelect = document.getElementById("Wards");
        const shipServiceSelect = document.getElementById("shipService");
        const giaship = document.getElementById("giaship");

        function getProvinces() {
            fetch("https://online-gateway.ghn.vn/shiip/public-api/master-data/province", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    token: token,
                },
            })
                .then((res) => res.json())
                .then((data) => {
                    const defaultOption = document.createElement("option");
                    defaultOption.value = ""; // Set the value as needed
                    defaultOption.textContent = "Chọn Tỉnh"; // Set the text content
                    // Set the 'disabled' and 'selected' attributes to make it the default option
                    defaultOption.disabled = true;
                    defaultOption.selected = true;
                    provinceSelect.appendChild(defaultOption);
                    const options = data.data;
                    for (let i = 0; i < options.length; i++) {
                        const option = document.createElement("option");
                        option.value = options[i].ProvinceID; // Set the value of the option (you can change this to any value you want)
                        option.text = options[i].ProvinceName; // Set the text of the option
                        option.setAttribute("providecode", options[i].ProvinceID);
                        provinceSelect.appendChild(option); // Add the option to the select element
                    }
                })
                .catch((error) => console.error("Error:", error));
        }

        function getDistricts() {
            const selectedOption = provinceSelect.options[provinceSelect.selectedIndex];
            const customAttribute = selectedOption.getAttribute("providecode");
            const provinceid = parseInt(customAttribute);
            fetch("https://online-gateway.ghn.vn/shiip/public-api/master-data/district", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    token: token,
                },
                body: JSON.stringify({province_id: provinceid}),
            })
                .then((res) => res.json())
                .then((data) => {
                    //remove all child
                    resetDistrict();
                    const options = data.data;
                    for (let i = 0; i < options.length; i++) {
                        const option = document.createElement("option");
                        option.value = options[i].DistrictID; // Set the value of the option (you can change this to any value you want)
                        option.text = options[i].DistrictName; // Set the text of the option
                        option.setAttribute("districtcode", options[i].DistrictID);
                        districtSelect.appendChild(option); // Add the option to the select element
                    }
                })
                .catch((error) => console.error("Error:", error));
        }

        function getWards() {
            const selectedOption = districtSelect.options[districtSelect.selectedIndex];
            const customAttribute = selectedOption.getAttribute("districtcode");
            const districtid = parseInt(customAttribute);
            fetch("https://online-gateway.ghn.vn/shiip/public-api/master-data/ward", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    token: token,
                },
                body: JSON.stringify({district_id: districtid}),
            })
                .then((res) => res.json())
                .then((data) => {
                    //remove all child
                    resetWard();
                    const options = data.data;
                    for (let i = 0; i < options.length; i++) {
                        const option = document.createElement("option");
                        option.value = options[i].WardCode; // Set the value of the option (you can change this to any value you want)
                        option.text = options[i].WardName;
                        // Set the text of the option
                        wardSelect.appendChild(option); // Add the option to the select element
                    }
                })
                .catch((error) => console.error("Error:", error));
        }

        function setFullAdress() {
            const proselect = provinceSelect.options[provinceSelect.selectedIndex];
            const proname = proselect.text;
            const districselect = districtSelect.options[districtSelect.selectedIndex];
            const distname = districselect.text;
            const wardName = wardSelect.options[wardSelect.selectedIndex];
            const wardname = wardName.text;
            const fullAdress = wardname + ", " + distname + " ," + proname;
            document.getElementById("FullAddress").value = String(fullAdress);
            console.log(fullAdress)
        }

        function resetDistrict() {
            while (districtSelect.firstChild) {
                districtSelect.removeChild(districtSelect.firstChild);
            }
            const defaultOption = document.createElement("option");
            defaultOption.value = ""; // Set the value as needed
            defaultOption.textContent = "Chọn Quận/ Huyện"; // Set the text content

            // Set the 'disabled' and 'selected' attributes to make it the default option
            defaultOption.disabled = true;
            defaultOption.selected = true;

            districtSelect.appendChild(defaultOption);
            resetWard();
        }

        function resetWard() {
            while (wardSelect.firstChild) {
                wardSelect.removeChild(wardSelect.firstChild);
            }
            const defaultOption = document.createElement("option");
            defaultOption.value = ""; // Set the value as needed
            defaultOption.textContent = "Chọn Thị Trấn/ Xã/ Phường"; // Set the text content

            // Set the 'disabled' and 'selected' attributes to make it the default option
            defaultOption.disabled = true;
            defaultOption.selected = true;

            wardSelect.appendChild(defaultOption);
        }

        getProvinces();
    </script>
</section>
</body>

</html>