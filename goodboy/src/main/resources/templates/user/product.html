<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" layout:decorate="~{user/layout_user}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Fashi Template">
    <meta name="keywords" content="Fashi, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Khăn choàng</title>
</head>

<body>


<section layout:fragment="content">
    <div class="breacrumb-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-text">
                        <a th:href="@{/home}"><i class="fa fa-home"></i> Trang chủ</a>
                        <span>Sản phẩm</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb Section Begin -->

    <!-- Product Shop Section Begin -->
    <section class="product-shop spad">
        <div class="container">
            <div class="order-1 order-lg-2">
                <div class="product-show-option">
                    <div class="row">
                        <div class="col-lg-7 col-md-7">
                            <div class="d-inline-flex w-100">
                                <div class="select-option w-100" id="category" style="">
                                    <select class="sorting w-50">
                                        <option value="">Tất cả sản phẩm</option>
                                        <c:forEach items="${categories}" var="category">
                                            <option value="${category.id}" onclick="alert(123)">${category.name}</option>
                                        </c:forEach>
                                    </select>
                                </div>
                            </div>

                        </div>
                        <div class="col-lg-5 col-md-5 d-flex justify-content-end">
                            <div class="select-option w-100  d-flex justify-content-end" id="sort">
                                <select class="sorting w-50">
                                    <option value="true">Giá tăng dần</option>
                                    <option value="false">Giá giảm dần</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Sản phầm -->
                <div class="product-list" id="product-content">
                    <div class="container">
                        <div class="row">

                            <div th:each="productdetail : ${list}" class="col-lg-3 col-md-6">
                                <div class="product-item">
                                    <div class="pi-pic">
                                        <div
                                                th:if="${productdetail.imageProducts !=null && productdetail.imageProducts.size() > 0}">
                                            <img th:src="${productdetail.imageProducts[0].img}" alt="Ảnh sản phẩm"/>
                                        </div>

                                        <ul>
                                            <li class="w-icon active"><a
                                                    th:onclick="'addToCart(\'' + ${productdetail.id} + '\')'"><i
                                                    class="icon_bag_alt"></i></a></li>
                                            <!-- <li class="quick-view"><a href="user/detail/*{productdetail.id}">Chi tiết
                                                    sản phẩm</a></li> -->
                                            <li class="quick-view"><a
                                                    th:href="@{/user/detail/{productId}(productId=${productdetail.id})}">Chi
                                                tiết sản phẩm</a></li>

                                            <li class="w-icon"><a href="#"><i class="fa fa-random"></i></a></li>
                                        </ul>
                                    </div>
                                    <div class="pi-text">
                                        <div class="catagory-name" th:text="${productdetail.idProduct.name}"></div>
                                        <a href="#">
                                            <h5 th:text="${productdetail.name}"></h5>
                                        </a>
                                        <div class="product-price">
                                            <span th:text="${productdetail.price}"/> VND

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Phân trang -->
            <div class="table-footer d-flex justify-content-between mt-3">
                <div class="text-start">This page is <span th:text="${crpage}"></span> of <span
                        th:text="${totalpage}"></span></div>
                <div class="text-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center">
                            <li class="page-item disabled" th:if="${crpage-1 < 1}">
                                <a class="page-link" th:href="@{/user/page(pageno=${crpage-1})}" tabindex="-1"
                                   aria-disabled="true"><i class="fas fa-chevron-left fa-sm"></i></a>
                            </li>
                            <li class="page-item" th:unless="${crpage-1 < 1}">
                                <a class="page-link" th:href="@{/user/page(pageno=${crpage-1})}"><i
                                        class="fas fa-chevron-left fa-sm"></i></a>
                            </li>
                            <th:block th:each="page : ${pagenumber}">
                                <li class="page-item"
                                    th:class="${crpage == page} ? 'page-item active' : 'page-item'">
                                    <a class="page-link" th:href="@{/user/page(pageno=${page})}"
                                       th:text="${page}"></a>
                                </li>
                            </th:block>
                            <li class="page-item disabled" th:if="${crpage == totalpage}">
                                <a class="page-link" th:href="@{/user/page(pageno=${crpage+1})}" tabindex="-1"
                                   aria-disabled="true"><i class="fas fa-chevron-right fa-sm"></i></a>
                            </li>
                            <li class="page-item" th:unless="${crpage == totalpage}">
                                <a class="page-link" th:href="@{/user/page(pageno=${crpage+1})}"><i
                                        class="fas fa-chevron-right fa-sm"></i></a>
                            </li>
                        </ul>
                    </nav><!-- End Centered Pagination -->
                </div>
                <form action="#" class="mx-2" th:action="@{/user/getcountrow}" method="get" id="rowCountForm">
                    Number of rows
                    <select name="selectedValue" class="border-0 px-2"
                            onchange="document.getElementById('rowCountForm').submit();">
                        <option value="10" th:selected="${rowcount == 10}">10</option>
                        <option value="20" th:selected="${rowcount == 20}">20</option>
                        <option value="50" th:selected="${rowcount == 50}">50</option>
                    </select>
                </form>
            </div>
        </div>

        <div>
            <div class="text-center">

            </div>
        </div>
    </section>
</section>

<script>
    $('.item_nav').eq(2).addClass('active');

    function addToCart(productId) {
        var apiUrl = '/api/cart/update?productId=' + productId + '&quantity=1&isReplace=false';
        $.ajax({
            url: apiUrl,
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                $('#totalQuantity').html(data.totalQuantity);
                $('#totalPrice1').html(data.totalPrice.toLocaleString('en-US') + ' VND');
                $('#totalPrice2').html(data.totalPrice.toLocaleString('en-US') + ' VND');
                $.ajax({
                    url: '/products',
                    type: 'GET',
                    success: function (data) {
                        $('#cartShow').html($(data).find('#cartShow').children());
                    },
                    error: function (error) {
                        alert('Error: ' + error);
                    }
                })
                alert('Add product to cart success.');
            },
            error: function (error) {
                alert('Add product to cart fail. Error: ' + error);
            }

        });
        return false;
    }
</script>

<script>
    function submitForm(p, gender) {
        document.querySelector('#p').value = p;
        document.querySelector('#gender').value = gender;
    }


    function select(ele, page) {
        $.ajax({
            url: '/products',
            method: 'GET',
            data: {
                price: $('#sort .selected').attr('data-value'),
                categoryId: $('#category .selected').attr('data-value'),
                page: page
            },
            success: function (data) {
                $('#product-content').html($(data).find('#product-content').html());
            },
            error: function error() {

            }
        })
    }

    $('#sort .option').on("click", function () {
        $.ajax({
            url: "/products",
            method: 'GET',
            data: {
                price: $(this).attr('data-value'),
                categoryId: $('#category .selected').attr('data-value')
            },
            success: function (data) {
                $('#product-content').html($(data).find('#product-content').html());
            }
        })
    });
    $('#category .option').on("click", function () {
        $.ajax({
            url: "/products",
            method: 'GET',
            data: {
                price: $('#sort .selected').attr('data-value'),
                categoryId: $(this).attr('data-value'),
            },
            success: function (data) {
                $('#product-content').html($(data).find('#product-content').html());
            }
        })
    });
</script>
</body>

</html>